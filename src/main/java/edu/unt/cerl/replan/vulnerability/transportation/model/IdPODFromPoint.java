/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package edu.unt.cerl.replan.vulnerability.transportation.model;

import edu.unt.cerl.applicationframework.model.DefaultConstants;
import edu.unt.cerl.replan.REPLAN;
import edu.unt.cerl.replan.model.ScenarioState;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;

/**
 *
 * @author martyo
 */
public class IdPODFromPoint {

    public static int point2POD(double x, double y) throws SQLException {
        ScenarioState state = REPLAN.getMainFrame().getTabs().getSelectedScenario().getState();
        String author = state.getAuthor();
        String workingCopyName = state.getWorkingCopyName();
        Connection c = REPLAN.getController().getConnection();
        int pod_id = 0;

        String query = "SELECT catch.id "
                + "FROM " + author + "." + workingCopyName + DefaultConstants.CATCHMENT_SUFFIX + " AS catch "
                + "WHERE "
                + "ST_CONTAINS("
                + "catch.the_geom,"
                + "ST_GeomFromText('POINT(" + x + " " + y + ")', 4326));";
        System.out.println(query);
        ResultSet result = c.createStatement().executeQuery(query);
        result.next();
        pod_id = result.getInt("id");


        return pod_id;
    }
}
